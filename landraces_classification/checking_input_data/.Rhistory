ciat2$Seed.color2[grep(pattern = " Cream", x = ciat2$Seed.color2)] <- "Cream"
ciat2$Seed.color2[grep(pattern = " Other", x = ciat2$Seed.color2)] <- "Other"
ciat2$Seed.color2[grep(pattern = " Pink", x = ciat2$Seed.color2)] <- "Pink"
ciat2$Seed.color2[grep(pattern = " Purple", x = ciat2$Seed.color2)] <- "Purple"
ciat2$Seed.color2[grep(pattern = " Red", x = ciat2$Seed.color2)] <- "Red"
ciat2$Seed.color2[grep(pattern = " White", x = ciat2$Seed.color2)] <- "White"
ciat2$Seed.color2[grep(pattern = " Yellow", x = ciat2$Seed.color2)] <- "Yellow"
ciat2$Seed.color3[grep(pattern = " Black", x = ciat2$Seed.color3)] <- "Black"
ciat2$Seed.color3[grep(pattern = " Brown", x = ciat2$Seed.color3)] <- "Brown"
ciat2$Seed.color3[grep(pattern = " Cream", x = ciat2$Seed.color3)] <- "Cream"
ciat2$Seed.color3[grep(pattern = " Other", x = ciat2$Seed.color3)] <- "Other"
ciat2$Seed.color3[grep(pattern = " Pink", x = ciat2$Seed.color3)] <- "Pink"
ciat2$Seed.color3[grep(pattern = " Purple", x = ciat2$Seed.color3)] <- "Purple"
ciat2$Seed.color3[grep(pattern = " Red", x = ciat2$Seed.color3)] <- "Red"
ciat2$Seed.color3[grep(pattern = " White", x = ciat2$Seed.color3)] <- "White"
ciat2$Seed.color3[grep(pattern = " Yellow", x = ciat2$Seed.color3)] <- "Yellow"
color_list <- c(ciat2$Seed.color %>% as.character %>% unique,
ciat2$Seed.color2 %>% as.character %>% unique,
ciat2$Seed.color3 %>% as.character %>% unique) %>% unique %>% sort
for(i in 1:length(color_list)){
eval(parse(text = paste0("ciat2$Color_", color_list[i], " <- 0")))
col_id <- which(ciat2$Seed.color == color_list[i] | ciat2$Seed.color2 == color_list[i] | ciat2$Seed.color3 == color_list[i])
if(length(col_id) > 0){
eval(parse(text = paste0("ciat2$Color_", color_list[i], "[col_id] <- 1")))
}
}; rm(i, col_id, color_list)
ciat2$Seed.color <- ciat2$Seed.color2 <- ciat2$Seed.color3 <- NULL
ciat2 <- ciat2 %>% tidyr::separate(Protein, into = c("Protein", "Protein2", "Protein3", "Protein4", "Protein5"), sep = ",")
ciat2$Protein[grep(pattern = "^B\\?", x = ciat2$Protein)] <- "B"
ciat2$Protein[grep(pattern = "^C\\?", x = ciat2$Protein)] <- "C"
ciat2$Protein[grep(pattern = "^Ca1\\(2D\\)?", x = ciat2$Protein)] <- "Ca1"
ciat2$Protein[grep(pattern = "CAR\\(2D\\)?$", x = ciat2$Protein)] <- "CAR"
ciat2$Protein[grep(pattern = "CAR\\(2D\\)H1", x = ciat2$Protein)] <- "CAR,H1"
ciat2$Protein[grep(pattern = "CH \\(2D\\)", x = ciat2$Protein)] <- "CH"
ciat2$Protein[grep(pattern = "CH\\(2D\\)", x = ciat2$Protein)] <- "CH"
ciat2$Protein[grep(pattern = "CH\\?", x = ciat2$Protein)] <- "CH"
ciat2$Protein[grep(pattern = "H\\?", x = ciat2$Protein)] <- "H"
ciat2$Protein[grep(pattern = "H1\\(2D\\)", x = ciat2$Protein)] <- "H1"
ciat2$Protein[grep(pattern = "H1\\?", x = ciat2$Protein)] <- "H1"
ciat2$Protein[grep(pattern = "H2\\(2D\\)", x = ciat2$Protein)] <- "H2"
ciat2$Protein[grep(pattern = "HE\\(2D\\)", x = ciat2$Protein)] <- "HE"
ciat2$Protein[grep(pattern = "L \\(2D\\)", x = ciat2$Protein)] <- "L"
ciat2$Protein[grep(pattern = "LI\\(2D\\)", x = ciat2$Protein)] <- "LI"
ciat2$Protein[grep(pattern = "M13\\? o M4\\?", x = ciat2$Protein)] <- "M13,M4"
ciat2$Protein[grep(pattern = "P1\\?", x = ciat2$Protein)] <- "P1"
ciat2$Protein[grep(pattern = "S\\(2D\\)", x = ciat2$Protein)] <- "S"
ciat2$Protein[grep(pattern = "S\\?$", x = ciat2$Protein)] <- "S"
ciat2$Protein[grep(pattern = "S\\?B\\?", x = ciat2$Protein)] <- "S,B"
ciat2$Protein[grep(pattern = "Sd\\(2D\\)", x = ciat2$Protein)] <- "Sd"
ciat2$Protein[grep(pattern = "SIMPLE \\?", x = ciat2$Protein)] <- "SIMPLE"
ciat2$Protein[grep(pattern = "T \\(2D\\)", x = ciat2$Protein)] <- "T"
ciat2$Protein[grep(pattern = "T\\(2D\\)", x = ciat2$Protein)] <- "T"
ciat2$Protein[grep(pattern = "T\\?", x = ciat2$Protein)] <- "T"
ciat2$Protein[grep(pattern = "TI1\\(2D\\)", x = ciat2$Protein)] <- "TI1"
ciat2$Protein[grep(pattern = "TI2\\(2D\\)", x = ciat2$Protein)] <- "TI2"
ciat2$Protein[grep(pattern = "To\\?", x = ciat2$Protein)] <- "To"
ciat2 <- ciat2 %>% tidyr::separate(Protein, into = c("Protein", "Protein6"), sep = ",")
ciat2$Protein2[grep(pattern = " H1\\(LCG\\)", x = ciat2$Protein2)] <- "H1"
ciat2$Protein2[grep(pattern = "C\\?", x = ciat2$Protein2)] <- "C"
ciat2$Protein2[grep(pattern = "^Ca\\?", x = ciat2$Protein2)] <- "Ca"
ciat2$Protein2[grep(pattern = "^CAR\\(2D\\)", x = ciat2$Protein2)] <- "CAR"
ciat2$Protein2[grep(pattern = "^CH\\(2D\\)", x = ciat2$Protein2)] <- "CH"
ciat2$Protein2[grep(pattern = "^H1\\(2D", x = ciat2$Protein2)] <- "H1"
ciat2$Protein2[grep(pattern = "^Mu\\?", x = ciat2$Protein2)] <- "Mu"
ciat2$Protein2[grep(pattern = "^P1\\?", x = ciat2$Protein2)] <- "P1"
ciat2$Protein2[grep(pattern = "^S\\(2D", x = ciat2$Protein2)] <- "S"
ciat2$Protein2[grep(pattern = "^T\\?", x = ciat2$Protein2)] <- "T"
ciat2$Protein3[grep(pattern = "^C \\(\\?\\)", x = ciat2$Protein3)] <- "C"
ciat2$Protein3[grep(pattern = "^CAR\\(2D\\)", x = ciat2$Protein3)] <- "CAR"
ciat2$Protein3[grep(pattern = "^CH\\? \\(2D\\)", x = ciat2$Protein3)] <- "CH"
protein_list <- c(ciat2$Protein %>% as.character %>% unique,
ciat2$Protein2 %>% as.character %>% unique,
ciat2$Protein3 %>% as.character %>% unique,
ciat2$Protein4 %>% as.character %>% unique,
ciat2$Protein5 %>% as.character %>% unique,
ciat2$Protein6 %>% as.character %>% unique) %>% unique %>% sort
protein_list
ciat2$Protein %>% as.character %>% unique
ciat2$Protein %>% as.character %>% unique %>% sort
ciat2$Protein2 %>% as.character %>% unique %>% sort
ciat2$Protein3 %>% as.character %>% unique %>% sort
ciat2$Protein4 %>% as.character %>% unique %>% sort
ciat2$Protein5 %>% as.character %>% unique %>% sort
ciat2$Protein6 %>% as.character %>% unique %>% sort
protein_list[-1]
protein_list <- protein_list[-1]
for(i in 1:length(protein_list)){
eval(parse(text = paste0("ciat2$Protein_", protein_list[i], " <- 0")))
protein_id <- which(ciat2$Protein == protein_list[i] | ciat2$Protein2 == protein_list[i] | ciat2$Protein3 == protein_list[i] | ciat2$Protein4 == protein_list[i] | ciat2$Protein5 == protein_list[i] | ciat2$Protein6 == protein_list[i])
if(length(protein_id) > 0){
eval(parse(text = paste0("ciat2$Protein_", protein_list[i], "[protein_id] <- 1")))
}
}; rm(i, protein_id, protein_list)
ciat2$Protein <- ciat2$Protein2 <- ciat2$Protein3 <- ciat2$Protein4 <- ciat2$Protein5 <- ciat2$Protein6 <- NULL
View(ciat2)
names(ciat2)
ciat2$Growth.habit
table(ciat2$Growth.habit)
names(ciat2)
table(ciat2$Seed.shape)
table(ciat2$Seed.brightness)
table(ciat2$Seed.weight)
hist(ciat2$Seed.weight)
names(ciat2)
View(ciat2)
names(ciat)
ciat2 <- ciat %>% dplyr::select(ID, Accession.number, Common.names, Interpreted.name, Test, Vernacular.name, Genepool, Race.interpreted, Subgroup, Altitude, Longitude, Latitude, Growth.habit, Seed.color, Seed.shape, Seed.brightness, Seed.weight, Protein)
# Split colors
ciat2 <- ciat2 %>% tidyr::separate(Seed.color, into = c("Seed.color", "Seed.color2", "Seed.color3"), sep = ",")
ciat2$Seed.color[grep(pattern = "Crema ", x = ciat2$Seed.color)] <- "Cream"
ciat2$Seed.color[grep(pattern = "Rosaso", x = ciat2$Seed.color)] <- "Pink"
# ciat2$Seed.color[grep(pattern = "Blanco ", x = ciat2$Seed.color)] <- "White"
# ciat2$Seed.color[grep(pattern = "Morado ", x = ciat2$Seed.color)] <- "Purple"
ciat2$Seed.color2[grep(pattern = " Black", x = ciat2$Seed.color2)] <- "Black"
ciat2$Seed.color2[grep(pattern = " Brown", x = ciat2$Seed.color2)] <- "Brown"
ciat2$Seed.color2[grep(pattern = " Cream", x = ciat2$Seed.color2)] <- "Cream"
ciat2$Seed.color2[grep(pattern = " Other", x = ciat2$Seed.color2)] <- "Other"
ciat2$Seed.color2[grep(pattern = " Pink", x = ciat2$Seed.color2)] <- "Pink"
ciat2$Seed.color2[grep(pattern = " Purple", x = ciat2$Seed.color2)] <- "Purple"
ciat2$Seed.color2[grep(pattern = " Red", x = ciat2$Seed.color2)] <- "Red"
ciat2$Seed.color2[grep(pattern = " White", x = ciat2$Seed.color2)] <- "White"
ciat2$Seed.color2[grep(pattern = " Yellow", x = ciat2$Seed.color2)] <- "Yellow"
ciat2$Seed.color3[grep(pattern = " Black", x = ciat2$Seed.color3)] <- "Black"
ciat2$Seed.color3[grep(pattern = " Brown", x = ciat2$Seed.color3)] <- "Brown"
ciat2$Seed.color3[grep(pattern = " Cream", x = ciat2$Seed.color3)] <- "Cream"
ciat2$Seed.color3[grep(pattern = " Other", x = ciat2$Seed.color3)] <- "Other"
ciat2$Seed.color3[grep(pattern = " Pink", x = ciat2$Seed.color3)] <- "Pink"
ciat2$Seed.color3[grep(pattern = " Purple", x = ciat2$Seed.color3)] <- "Purple"
ciat2$Seed.color3[grep(pattern = " Red", x = ciat2$Seed.color3)] <- "Red"
ciat2$Seed.color3[grep(pattern = " White", x = ciat2$Seed.color3)] <- "White"
ciat2$Seed.color3[grep(pattern = " Yellow", x = ciat2$Seed.color3)] <- "Yellow"
color_list <- c(ciat2$Seed.color %>% as.character %>% unique,
ciat2$Seed.color2 %>% as.character %>% unique,
ciat2$Seed.color3 %>% as.character %>% unique) %>% unique %>% sort
for(i in 1:length(color_list)){
eval(parse(text = paste0("ciat2$Color_", color_list[i], " <- 0")))
col_id <- which(ciat2$Seed.color == color_list[i] | ciat2$Seed.color2 == color_list[i] | ciat2$Seed.color3 == color_list[i])
if(length(col_id) > 0){
eval(parse(text = paste0("ciat2$Color_", color_list[i], "[col_id] <- 1")))
}
}; rm(i, col_id, color_list)
ciat2$Seed.color <- ciat2$Seed.color2 <- ciat2$Seed.color3 <- NULL
# Split proteins
ciat2 <- ciat2 %>% tidyr::separate(Protein, into = c("Protein", "Protein2", "Protein3", "Protein4", "Protein5"), sep = ",")
ciat2$Protein[grep(pattern = "^B\\?", x = ciat2$Protein)] <- "B"
ciat2$Protein[grep(pattern = "^C\\?", x = ciat2$Protein)] <- "C"
ciat2$Protein[grep(pattern = "^Ca1\\(2D\\)?", x = ciat2$Protein)] <- "Ca1"
ciat2$Protein[grep(pattern = "CAR\\(2D\\)?$", x = ciat2$Protein)] <- "CAR"
ciat2$Protein[grep(pattern = "CAR\\(2D\\)H1", x = ciat2$Protein)] <- "CAR,H1"
ciat2$Protein[grep(pattern = "CH \\(2D\\)", x = ciat2$Protein)] <- "CH"
ciat2$Protein[grep(pattern = "CH\\(2D\\)", x = ciat2$Protein)] <- "CH"
ciat2$Protein[grep(pattern = "CH\\?", x = ciat2$Protein)] <- "CH"
ciat2$Protein[grep(pattern = "H\\?", x = ciat2$Protein)] <- "H"
ciat2$Protein[grep(pattern = "H1\\(2D\\)", x = ciat2$Protein)] <- "H1"
ciat2$Protein[grep(pattern = "H1\\?", x = ciat2$Protein)] <- "H1"
ciat2$Protein[grep(pattern = "H2\\(2D\\)", x = ciat2$Protein)] <- "H2"
ciat2$Protein[grep(pattern = "HE\\(2D\\)", x = ciat2$Protein)] <- "HE"
ciat2$Protein[grep(pattern = "L \\(2D\\)", x = ciat2$Protein)] <- "L"
ciat2$Protein[grep(pattern = "LI\\(2D\\)", x = ciat2$Protein)] <- "LI"
ciat2$Protein[grep(pattern = "M13\\? o M4\\?", x = ciat2$Protein)] <- "M13,M4"
ciat2$Protein[grep(pattern = "P1\\?", x = ciat2$Protein)] <- "P1"
ciat2$Protein[grep(pattern = "S\\(2D\\)", x = ciat2$Protein)] <- "S"
ciat2$Protein[grep(pattern = "S\\?$", x = ciat2$Protein)] <- "S"
ciat2$Protein[grep(pattern = "S\\?B\\?", x = ciat2$Protein)] <- "S,B"
ciat2$Protein[grep(pattern = "Sd\\(2D\\)", x = ciat2$Protein)] <- "Sd"
ciat2$Protein[grep(pattern = "SIMPLE \\?", x = ciat2$Protein)] <- "SIMPLE"
ciat2$Protein[grep(pattern = "T \\(2D\\)", x = ciat2$Protein)] <- "T"
ciat2$Protein[grep(pattern = "T\\(2D\\)", x = ciat2$Protein)] <- "T"
ciat2$Protein[grep(pattern = "T\\?", x = ciat2$Protein)] <- "T"
ciat2$Protein[grep(pattern = "TI1\\(2D\\)", x = ciat2$Protein)] <- "TI1"
ciat2$Protein[grep(pattern = "TI2\\(2D\\)", x = ciat2$Protein)] <- "TI2"
ciat2$Protein[grep(pattern = "To\\?", x = ciat2$Protein)] <- "To"
ciat2 <- ciat2 %>% tidyr::separate(Protein, into = c("Protein", "Protein6"), sep = ",")
ciat2$Protein2[grep(pattern = " H1\\(LCG\\)", x = ciat2$Protein2)] <- "H1"
ciat2$Protein2[grep(pattern = "C\\?", x = ciat2$Protein2)] <- "C"
ciat2$Protein2[grep(pattern = "^Ca\\?", x = ciat2$Protein2)] <- "Ca"
ciat2$Protein2[grep(pattern = "^CAR\\(2D\\)", x = ciat2$Protein2)] <- "CAR"
ciat2$Protein2[grep(pattern = "^CH\\(2D\\)", x = ciat2$Protein2)] <- "CH"
ciat2$Protein2[grep(pattern = "^H1\\(2D", x = ciat2$Protein2)] <- "H1"
ciat2$Protein2[grep(pattern = "^Mu\\?", x = ciat2$Protein2)] <- "Mu"
ciat2$Protein2[grep(pattern = "^P1\\?", x = ciat2$Protein2)] <- "P1"
ciat2$Protein2[grep(pattern = "^S\\(2D", x = ciat2$Protein2)] <- "S"
ciat2$Protein2[grep(pattern = "^T\\?", x = ciat2$Protein2)] <- "T"
ciat2$Protein3[grep(pattern = "^C \\(\\?\\)", x = ciat2$Protein3)] <- "C"
ciat2$Protein3[grep(pattern = "^CAR\\(2D\\)", x = ciat2$Protein3)] <- "CAR"
ciat2$Protein3[grep(pattern = "^CH\\? \\(2D\\)", x = ciat2$Protein3)] <- "CH"
protein_list <- c(ciat2$Protein %>% as.character %>% unique,
ciat2$Protein2 %>% as.character %>% unique,
ciat2$Protein3 %>% as.character %>% unique,
ciat2$Protein4 %>% as.character %>% unique,
ciat2$Protein5 %>% as.character %>% unique,
ciat2$Protein6 %>% as.character %>% unique) %>% unique %>% sort
protein_list <- protein_list[-1]
for(i in 1:length(protein_list)){
eval(parse(text = paste0("ciat2$Protein_", protein_list[i], " <- 0")))
protein_id <- which(ciat2$Protein == protein_list[i] | ciat2$Protein2 == protein_list[i] | ciat2$Protein3 == protein_list[i] | ciat2$Protein4 == protein_list[i] | ciat2$Protein5 == protein_list[i] | ciat2$Protein6 == protein_list[i])
if(length(protein_id) > 0){
eval(parse(text = paste0("ciat2$Protein_", protein_list[i], "[protein_id] <- 1")))
}
}; rm(i, protein_id, protein_list)
ciat2$Protein <- ciat2$Protein2 <- ciat2$Protein3 <- ciat2$Protein4 <- ciat2$Protein5 <- ciat2$Protein6 <- NULL
names(ciat2)
paste0(root, "/gap_analysis_landraces/Input_data/_occurrence_data/_ciat_data/Bean/ciatOrganizedVariables.RDS")
if(!file.exists(paste0(root, "/gap_analysis_landraces/Input_data/_occurrence_data/_ciat_data/Bean/ciatOrganizedVariables.RDS"))){
saveRDS(ciat2, paste0(root, "/gap_analysis_landraces/Input_data/_occurrence_data/_ciat_data/Bean/ciatOrganizedVariables.RDS"))
}
View(ciat2)
g <- gc
g <- gc()
rm(list = ls())
options(warn = -1); options(scipen = 999); g <- gc(reset = T); rm(list = ls())
OSys <- Sys.info(); OSys <- OSys[names(OSys)=="sysname"]
if(OSys == "Linux"){ root <- "/mnt/workspace_cluster_9" } else {
if(OSys == "Windows"){ root <- "//dapadfs/Workspace_cluster_9" }
}; rm(OSys)
suppressMessages(library(tidyverse))
suppressMessages(library(readxl))
suppressMessages(library(rgdal))
suppressMessages(library(sp))
suppressMessages(library(raster))
suppressMessages(library(ncdf4))
suppressMessages(library(rasterVis))
suppressMessages(library(htmlwidgets))
suppressMessages(library(compiler))
suppressMessages(library(leaflet))
suppressMessages(library(highcharter))
suppressMessages(library(plotly))
suppressMessages(library(d3heatmap))
suppressMessages(library(cluster))
suppressMessages(library(factoextra))
suppressMessages(library(gtools))
ciat <- read_excel(path = paste0(root, "/gap_analysis_landraces/Input_data/_occurrence_data/_ciat_data/Bean/CIAT_BEAN_DB_2017_08_25.xlsx"), sheet = "CLEANED_FILE")
nrow(ciat) # 37987 (old and original), 23831 (new one with vernacular names)
names(ciat)
names(ciat) <- c("ID", "Source", "Cleaned_by", "Accession.number", "Synonyms", "Common.names",
"Interpreted.name", "Test", "Vernacular.name", "Genepool", "Race.interpreted", "Race",
"Subgroup", "Reference", "Genus", "Species", "Subspecies", "Variety",
"Biological.status", "Type.of.material", "CORE.collection",
"Country", "Department", "County", "Place", "Altitude", "Latitude", "Longitude",
"Date.collection", "Name", "Name2", "Institution", "Country3",
"Date.receipt", "Growth.habit", "Seed.color", "Seed.shape", "Seed.brightness", "Seed.weight",
"Days.to.flowering", "Place4", "Year", "Responsible", "First.harvest", "Last.harvest",
"Place5", "Year6", "Responsible7", "Reaction", "Responsible8", "Reaction9",
"Responsible10", "Date.evaluation", "Protein", "Doubtful.cases", "Race.protein", "Responsible11")
shp_wld <- rgdal::readOGR(dsn = paste0(root, "/gap_analysis_landraces/Input_data/_maps/Global_administrative_unit_layers/gaul_2014"), layer = "G2014_2013_1")
rst_wld <- raster::raster(paste0(root, "/gap_analysis_landraces/Input_data/presence_data/world_body_waters_2-5.asc"))
ciat_empyCoordinates <- ciat[which(is.na(ciat$Longitude) & is.na(ciat$Latitude)),]
ciat_empyCoordinates <- ciat_empyCoordinates %>% dplyr::filter((!is.na(Country) |
!is.na(Department) |
!is.na(County) |
!is.na(Place)) & !is.na(Protein))
ciat <- ciat %>% dplyr::filter(!is.na(Longitude) & !is.na(ciat$Latitude) & !is.na(Protein))
over_res <- sp::over(SpatialPoints(coords = data.frame(lon = ciat$Longitude, lat = ciat$Latitude), proj4string = CRS(projargs = "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")), as(shp_wld, "SpatialPolygons"))
ciat$Wrong.coordinates <- as.numeric(is.na(over_res)); rm(over_res)
sum(ciat$Wrong.coordinates) # 153 (old and original), 87 (new one with vernacular names)
ciat$Wrong.coordinates2 <- raster::extract(x = rst_wld, y = ciat[c("Longitude", "Latitude")])
sum(is.na(ciat$Wrong.coordinates2)) # 69 (new one with vernacular names)
rm(shp_wld, rst_wld)
ciat %>% names
ciat2 <- ciat %>% dplyr::select(ID, Accession.number, Common.names, Interpreted.name, Test, Vernacular.name, Genepool, Race.interpreted, Subgroup, Altitude, Longitude, Latitude, Growth.habit, Seed.color, Seed.shape, Seed.brightness, Seed.weight, Protein, Race.protein)
ciat2 <- ciat2 %>% tidyr::separate(Seed.color, into = c("Seed.color", "Seed.color2", "Seed.color3"), sep = ",")
ciat2$Seed.color[grep(pattern = "Crema ", x = ciat2$Seed.color)] <- "Cream"
ciat2$Seed.color[grep(pattern = "Rosaso", x = ciat2$Seed.color)] <- "Pink"
ciat2$Seed.color2[grep(pattern = " Black", x = ciat2$Seed.color2)] <- "Black"
ciat2$Seed.color2[grep(pattern = " Brown", x = ciat2$Seed.color2)] <- "Brown"
ciat2$Seed.color2[grep(pattern = " Cream", x = ciat2$Seed.color2)] <- "Cream"
ciat2$Seed.color2[grep(pattern = " Other", x = ciat2$Seed.color2)] <- "Other"
ciat2$Seed.color2[grep(pattern = " Pink", x = ciat2$Seed.color2)] <- "Pink"
ciat2$Seed.color2[grep(pattern = " Purple", x = ciat2$Seed.color2)] <- "Purple"
ciat2$Seed.color2[grep(pattern = " Red", x = ciat2$Seed.color2)] <- "Red"
ciat2$Seed.color2[grep(pattern = " White", x = ciat2$Seed.color2)] <- "White"
ciat2$Seed.color2[grep(pattern = " Yellow", x = ciat2$Seed.color2)] <- "Yellow"
ciat2$Seed.color3[grep(pattern = " Black", x = ciat2$Seed.color3)] <- "Black"
ciat2$Seed.color3[grep(pattern = " Brown", x = ciat2$Seed.color3)] <- "Brown"
ciat2$Seed.color3[grep(pattern = " Cream", x = ciat2$Seed.color3)] <- "Cream"
ciat2$Seed.color3[grep(pattern = " Other", x = ciat2$Seed.color3)] <- "Other"
ciat2$Seed.color3[grep(pattern = " Pink", x = ciat2$Seed.color3)] <- "Pink"
ciat2$Seed.color3[grep(pattern = " Purple", x = ciat2$Seed.color3)] <- "Purple"
ciat2$Seed.color3[grep(pattern = " Red", x = ciat2$Seed.color3)] <- "Red"
ciat2$Seed.color3[grep(pattern = " White", x = ciat2$Seed.color3)] <- "White"
ciat2$Seed.color3[grep(pattern = " Yellow", x = ciat2$Seed.color3)] <- "Yellow"
color_list <- c(ciat2$Seed.color %>% as.character %>% unique,
ciat2$Seed.color2 %>% as.character %>% unique,
ciat2$Seed.color3 %>% as.character %>% unique) %>% unique %>% sort
for(i in 1:length(color_list)){
eval(parse(text = paste0("ciat2$Color_", color_list[i], " <- 0")))
col_id <- which(ciat2$Seed.color == color_list[i] | ciat2$Seed.color2 == color_list[i] | ciat2$Seed.color3 == color_list[i])
if(length(col_id) > 0){
eval(parse(text = paste0("ciat2$Color_", color_list[i], "[col_id] <- 1")))
}
}; rm(i, col_id, color_list)
ciat2$Seed.color <- ciat2$Seed.color2 <- ciat2$Seed.color3 <- NULL
ciat2 <- ciat2 %>% tidyr::separate(Protein, into = c("Protein", "Protein2", "Protein3", "Protein4", "Protein5"), sep = ",")
View(ciat2)
ciat2 <- ciat %>% dplyr::select(ID, Accession.number, Common.names, Interpreted.name, Test, Vernacular.name, Genepool, Race.interpreted, Subgroup, Altitude, Longitude, Latitude, Growth.habit, Seed.color, Seed.shape, Seed.brightness, Seed.weight, Protein, Race.protein)
# Split colors
ciat2 <- ciat2 %>% tidyr::separate(Seed.color, into = c("Seed.color", "Seed.color2", "Seed.color3"), sep = ",")
ciat2$Seed.color[grep(pattern = "Crema ", x = ciat2$Seed.color)] <- "Cream"
ciat2$Seed.color[grep(pattern = "Rosaso", x = ciat2$Seed.color)] <- "Pink"
# ciat2$Seed.color[grep(pattern = "Blanco ", x = ciat2$Seed.color)] <- "White"
# ciat2$Seed.color[grep(pattern = "Morado ", x = ciat2$Seed.color)] <- "Purple"
ciat2$Seed.color2[grep(pattern = " Black", x = ciat2$Seed.color2)] <- "Black"
ciat2$Seed.color2[grep(pattern = " Brown", x = ciat2$Seed.color2)] <- "Brown"
ciat2$Seed.color2[grep(pattern = " Cream", x = ciat2$Seed.color2)] <- "Cream"
ciat2$Seed.color2[grep(pattern = " Other", x = ciat2$Seed.color2)] <- "Other"
ciat2$Seed.color2[grep(pattern = " Pink", x = ciat2$Seed.color2)] <- "Pink"
ciat2$Seed.color2[grep(pattern = " Purple", x = ciat2$Seed.color2)] <- "Purple"
ciat2$Seed.color2[grep(pattern = " Red", x = ciat2$Seed.color2)] <- "Red"
ciat2$Seed.color2[grep(pattern = " White", x = ciat2$Seed.color2)] <- "White"
ciat2$Seed.color2[grep(pattern = " Yellow", x = ciat2$Seed.color2)] <- "Yellow"
ciat2$Seed.color3[grep(pattern = " Black", x = ciat2$Seed.color3)] <- "Black"
ciat2$Seed.color3[grep(pattern = " Brown", x = ciat2$Seed.color3)] <- "Brown"
ciat2$Seed.color3[grep(pattern = " Cream", x = ciat2$Seed.color3)] <- "Cream"
ciat2$Seed.color3[grep(pattern = " Other", x = ciat2$Seed.color3)] <- "Other"
ciat2$Seed.color3[grep(pattern = " Pink", x = ciat2$Seed.color3)] <- "Pink"
ciat2$Seed.color3[grep(pattern = " Purple", x = ciat2$Seed.color3)] <- "Purple"
ciat2$Seed.color3[grep(pattern = " Red", x = ciat2$Seed.color3)] <- "Red"
ciat2$Seed.color3[grep(pattern = " White", x = ciat2$Seed.color3)] <- "White"
ciat2$Seed.color3[grep(pattern = " Yellow", x = ciat2$Seed.color3)] <- "Yellow"
color_list <- c(ciat2$Seed.color %>% as.character %>% unique,
ciat2$Seed.color2 %>% as.character %>% unique,
ciat2$Seed.color3 %>% as.character %>% unique) %>% unique %>% sort
for(i in 1:length(color_list)){
eval(parse(text = paste0("ciat2$Color_", color_list[i], " <- 0")))
col_id <- which(ciat2$Seed.color == color_list[i] | ciat2$Seed.color2 == color_list[i] | ciat2$Seed.color3 == color_list[i])
if(length(col_id) > 0){
eval(parse(text = paste0("ciat2$Color_", color_list[i], "[col_id] <- 1")))
}
}; rm(i, col_id, color_list)
ciat2$Seed.color <- ciat2$Seed.color2 <- ciat2$Seed.color3 <- NULL
ciat2$Protein[grep(pattern = "\\?", x = ciat2$Protein)]
ciat2$Protein[grep(pattern = "\\?", x = ciat2$Protein)] <- NA
ciat2 <- ciat2 %>% tidyr::separate(Protein, into = c("Protein", "Protein2", "Protein3", "Protein4", "Protein5"), sep = ",")
ciat2$Protein %>% unique %>% as.character %>% sort
ciat2$Protein[grep(pattern = "Ca1\\(2D\\)", x = ciat2$Protein)] <- "Ca1"
ciat2$Protein[grep(pattern = "CAR\\(2D\\)", x = ciat2$Protein)] <- "CAR"
ciat2$Protein[grep(pattern = "CAR\\(2D\\)H1", x = ciat2$Protein)] <- "CAR,H1"
ciat2$Protein[grep(pattern = "CH \\(2D\\)", x = ciat2$Protein)] <- "CH"
ciat2$Protein[grep(pattern = "CH\\(2D\\)", x = ciat2$Protein)] <- "CH"
ciat2$Protein[grep(pattern = "H1\\(2D\\)", x = ciat2$Protein)] <- "H1"
ciat2$Protein[grep(pattern = "H2\\(2D\\)", x = ciat2$Protein)] <- "H2"
ciat2$Protein[grep(pattern = "HE\\(2D\\)", x = ciat2$Protein)] <- "HE"
ciat2$Protein[grep(pattern = "L \\(2D\\)", x = ciat2$Protein)] <- "L"
ciat2$Protein[grep(pattern = "LI\\(2D\\)", x = ciat2$Protein)] <- "LI"
ciat2$Protein[grep(pattern = "S\\(2D\\)", x = ciat2$Protein)] <- "S"
ciat2$Protein[grep(pattern = "Sd\\(2D\\)", x = ciat2$Protein)] <- "Sd"
ciat2$Protein[grep(pattern = "T \\(2D\\)", x = ciat2$Protein)] <- "T"
ciat2$Protein[grep(pattern = "T\\(2D\\)", x = ciat2$Protein)] <- "T"
ciat2$Protein[grep(pattern = "TI1\\(2D\\)", x = ciat2$Protein)] <- "TI1"
ciat2$Protein[grep(pattern = "TI2\\(2D\\)", x = ciat2$Protein)] <- "TI2"
ciat2$Protein %>% unique %>% as.character %>% sort
ciat2$Protein2 %>% unique %>% as.character %>% sort
ciat2$Protein2[grep(pattern = " H1\\(LCG\\)", x = ciat2$Protein2)] <- "H1"
ciat2$Protein2[grep(pattern = "^CAR\\(2D\\)", x = ciat2$Protein2)] <- "CAR"
ciat2$Protein2[grep(pattern = "^CH\\(2D\\)", x = ciat2$Protein2)] <- "CH"
ciat2$Protein2[grep(pattern = "^H1\\(2D", x = ciat2$Protein2)] <- "H1"
ciat2$Protein2[grep(pattern = "^S\\(2D", x = ciat2$Protein2)] <- "S"
ciat2$Protein3 %>% unique %>% as.character %>% sort
ciat2$Protein3[grep(pattern = "^CAR\\(2D\\)", x = ciat2$Protein3)] <- "CAR"
ciat2$Protein3 %>% unique %>% as.character %>% sort
ciat2$Protein2 %>% unique %>% as.character %>% sort
ciat2$Protein4 %>% unique %>% as.character %>% sort
ciat2$Protein5 %>% unique %>% as.character %>% sort
protein_list <- c(ciat2$Protein %>% as.character %>% unique,
ciat2$Protein2 %>% as.character %>% unique,
ciat2$Protein3 %>% as.character %>% unique,
ciat2$Protein4 %>% as.character %>% unique,
ciat2$Protein5 %>% as.character %>% unique) %>% unique %>% sort
protein_list
protein_list <- protein_list[-1]
for(i in 1:length(protein_list)){
eval(parse(text = paste0("ciat2$Protein_", protein_list[i], " <- 0")))
protein_id <- which(ciat2$Protein == protein_list[i] | ciat2$Protein2 == protein_list[i] | ciat2$Protein3 == protein_list[i] | ciat2$Protein4 == protein_list[i] | ciat2$Protein5 == protein_list[i] | ciat2$Protein6 == protein_list[i])
if(length(protein_id) > 0){
eval(parse(text = paste0("ciat2$Protein_", protein_list[i], "[protein_id] <- 1")))
}
}; rm(i, protein_id, protein_list)
ciat2$Protein <- ciat2$Protein2 <- ciat2$Protein3 <- ciat2$Protein4 <- ciat2$Protein5 <- NULL
View(ciat2)
names(ciat2)
saveRDS(ciat2, paste0(root, "/gap_analysis_landraces/Input_data/_occurrence_data/_ciat_data/Bean/ciatOrganizedVariables.RDS"))
options(warn = -1); options(scipen = 999); g <- gc(reset = T); rm(list = ls())
OSys <- Sys.info(); OSys <- OSys[names(OSys)=="sysname"]
if(OSys == "Linux"){ root <- "/mnt/workspace_cluster_9" } else {
if(OSys == "Windows"){ root <- "//dapadfs/Workspace_cluster_9" }
}; rm(OSys)
# Load packages
suppressMessages(library(tidyverse))
suppressMessages(library(readxl))
suppressMessages(library(rgdal))
suppressMessages(library(sp))
suppressMessages(library(raster))
suppressMessages(library(ncdf4))
suppressMessages(library(rasterVis))
suppressMessages(library(htmlwidgets))
suppressMessages(library(compiler))
suppressMessages(library(leaflet))
suppressMessages(library(highcharter))
suppressMessages(library(plotly))
suppressMessages(library(d3heatmap))
suppressMessages(library(cluster))
suppressMessages(library(factoextra))
suppressMessages(library(gtools))
ciat <- read_excel(path = paste0(root, "/gap_analysis_landraces/Input_data/_occurrence_data/_ciat_data/Bean/CIAT_BEAN_DB_2017_08_25.xlsx"), sheet = "CLEANED_FILE")
nrow(ciat) # 37987 (old and original), 23831 (new one with vernacular names)
names(ciat) <- c("ID", "Source", "Cleaned_by", "Accession.number", "Synonyms", "Common.names",
"Interpreted.name", "Test", "Vernacular.name", "Genepool", "Race.interpreted", "Race",
"Subgroup", "Reference", "Genus", "Species", "Subspecies", "Variety",
"Biological.status", "Type.of.material", "CORE.collection",
"Country", "Department", "County", "Place", "Altitude", "Latitude", "Longitude",
"Date.collection", "Name", "Name2", "Institution", "Country3",
"Date.receipt", "Growth.habit", "Seed.color", "Seed.shape", "Seed.brightness", "Seed.weight",
"Days.to.flowering", "Place4", "Year", "Responsible", "First.harvest", "Last.harvest",
"Place5", "Year6", "Responsible7", "Reaction", "Responsible8", "Reaction9",
"Responsible10", "Date.evaluation", "Protein", "Doubtful.cases", "Race.protein", "Responsible11")
shp_wld <- rgdal::readOGR(dsn = paste0(root, "/gap_analysis_landraces/Input_data/_maps/Global_administrative_unit_layers/gaul_2014"), layer = "G2014_2013_1")
rst_wld <- raster::raster(paste0(root, "/gap_analysis_landraces/Input_data/presence_data/world_body_waters_2-5.asc"))
ciat <- ciat %>% dplyr::filter(!is.na(Longitude) & !is.na(ciat$Latitude) & !is.na(Protein))
over_res <- sp::over(SpatialPoints(coords = data.frame(lon = ciat$Longitude, lat = ciat$Latitude), proj4string = CRS(projargs = "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")), as(shp_wld, "SpatialPolygons"))
ciat$Wrong.coordinates <- as.numeric(is.na(over_res)); rm(over_res)
ciat$Wrong.coordinates2 <- raster::extract(x = rst_wld, y = ciat[c("Longitude", "Latitude")])
ciat2 <- ciat %>% dplyr::select(ID, Accession.number, Common.names, Interpreted.name, Test, Vernacular.name, Genepool, Race.interpreted, Subgroup, Altitude, Longitude, Latitude, Growth.habit, Seed.color, Seed.shape, Seed.brightness, Seed.weight, Protein, Race.protein)
ciat2 <- ciat2 %>% tidyr::separate(Seed.color, into = c("Seed.color", "Seed.color2", "Seed.color3"), sep = ",")
ciat2$Seed.color[grep(pattern = "Crema ", x = ciat2$Seed.color)] <- "Cream"
ciat2$Seed.color[grep(pattern = "Rosaso", x = ciat2$Seed.color)] <- "Pink"
ciat2$Seed.color2[grep(pattern = " Black", x = ciat2$Seed.color2)] <- "Black"
ciat2$Seed.color2[grep(pattern = " Brown", x = ciat2$Seed.color2)] <- "Brown"
ciat2$Seed.color2[grep(pattern = " Cream", x = ciat2$Seed.color2)] <- "Cream"
ciat2$Seed.color2[grep(pattern = " Other", x = ciat2$Seed.color2)] <- "Other"
ciat2$Seed.color2[grep(pattern = " Pink", x = ciat2$Seed.color2)] <- "Pink"
ciat2$Seed.color2[grep(pattern = " Purple", x = ciat2$Seed.color2)] <- "Purple"
ciat2$Seed.color2[grep(pattern = " Red", x = ciat2$Seed.color2)] <- "Red"
ciat2$Seed.color2[grep(pattern = " White", x = ciat2$Seed.color2)] <- "White"
ciat2$Seed.color2[grep(pattern = " Yellow", x = ciat2$Seed.color2)] <- "Yellow"
ciat2$Seed.color3[grep(pattern = " Black", x = ciat2$Seed.color3)] <- "Black"
ciat2$Seed.color3[grep(pattern = " Brown", x = ciat2$Seed.color3)] <- "Brown"
ciat2$Seed.color3[grep(pattern = " Cream", x = ciat2$Seed.color3)] <- "Cream"
ciat2$Seed.color3[grep(pattern = " Other", x = ciat2$Seed.color3)] <- "Other"
ciat2$Seed.color3[grep(pattern = " Pink", x = ciat2$Seed.color3)] <- "Pink"
ciat2$Seed.color3[grep(pattern = " Purple", x = ciat2$Seed.color3)] <- "Purple"
ciat2$Seed.color3[grep(pattern = " Red", x = ciat2$Seed.color3)] <- "Red"
ciat2$Seed.color3[grep(pattern = " White", x = ciat2$Seed.color3)] <- "White"
ciat2$Seed.color3[grep(pattern = " Yellow", x = ciat2$Seed.color3)] <- "Yellow"
color_list <- c(ciat2$Seed.color %>% as.character %>% unique,
ciat2$Seed.color2 %>% as.character %>% unique,
ciat2$Seed.color3 %>% as.character %>% unique) %>% unique %>% sort
for(i in 1:length(color_list)){
eval(parse(text = paste0("ciat2$Color_", color_list[i], " <- 0")))
col_id <- which(ciat2$Seed.color == color_list[i] | ciat2$Seed.color2 == color_list[i] | ciat2$Seed.color3 == color_list[i])
if(length(col_id) > 0){
eval(parse(text = paste0("ciat2$Color_", color_list[i], "[col_id] <- 1")))
}
}; rm(i, col_id, color_list)
ciat2$Seed.color <- ciat2$Seed.color2 <- ciat2$Seed.color3 <- NULL
ciat2$Protein[grep(pattern = "\\?", x = ciat2$Protein)] <- NA
ciat2 <- ciat2 %>% tidyr::separate(Protein, into = c("Protein", "Protein2", "Protein3", "Protein4", "Protein5"), sep = ",")
ciat2$Protein[grep(pattern = "Ca1\\(2D\\)", x = ciat2$Protein)] <- "Ca1"
ciat2$Protein[grep(pattern = "CAR\\(2D\\)", x = ciat2$Protein)] <- "CAR"
ciat2$Protein[grep(pattern = "CAR\\(2D\\)H1", x = ciat2$Protein)] <- "CAR,H1"
ciat2$Protein[grep(pattern = "CH \\(2D\\)", x = ciat2$Protein)] <- "CH"
ciat2$Protein[grep(pattern = "CH\\(2D\\)", x = ciat2$Protein)] <- "CH"
ciat2$Protein[grep(pattern = "H1\\(2D\\)", x = ciat2$Protein)] <- "H1"
ciat2$Protein[grep(pattern = "H2\\(2D\\)", x = ciat2$Protein)] <- "H2"
ciat2$Protein[grep(pattern = "HE\\(2D\\)", x = ciat2$Protein)] <- "HE"
ciat2$Protein[grep(pattern = "L \\(2D\\)", x = ciat2$Protein)] <- "L"
ciat2$Protein[grep(pattern = "LI\\(2D\\)", x = ciat2$Protein)] <- "LI"
ciat2$Protein[grep(pattern = "S\\(2D\\)", x = ciat2$Protein)] <- "S"
ciat2$Protein[grep(pattern = "Sd\\(2D\\)", x = ciat2$Protein)] <- "Sd"
ciat2$Protein[grep(pattern = "T \\(2D\\)", x = ciat2$Protein)] <- "T"
ciat2$Protein[grep(pattern = "T\\(2D\\)", x = ciat2$Protein)] <- "T"
ciat2$Protein[grep(pattern = "TI1\\(2D\\)", x = ciat2$Protein)] <- "TI1"
ciat2$Protein[grep(pattern = "TI2\\(2D\\)", x = ciat2$Protein)] <- "TI2"
ciat2$Protein2[grep(pattern = " H1\\(LCG\\)", x = ciat2$Protein2)] <- "H1"
ciat2$Protein2[grep(pattern = "^CAR\\(2D\\)", x = ciat2$Protein2)] <- "CAR"
ciat2$Protein2[grep(pattern = "^CH\\(2D\\)", x = ciat2$Protein2)] <- "CH"
ciat2$Protein2[grep(pattern = "^H1\\(2D", x = ciat2$Protein2)] <- "H1"
ciat2$Protein2[grep(pattern = "^S\\(2D", x = ciat2$Protein2)] <- "S"
ciat2$Protein3[grep(pattern = "^CAR\\(2D\\)", x = ciat2$Protein3)] <- "CAR"
protein_list <- c(ciat2$Protein %>% as.character %>% unique,
ciat2$Protein2 %>% as.character %>% unique,
ciat2$Protein3 %>% as.character %>% unique,
ciat2$Protein4 %>% as.character %>% unique,
ciat2$Protein5 %>% as.character %>% unique) %>% unique %>% sort
protein_list
protein_list <- protein_list[-1]
View(ciat2)
for(i in 1:length(protein_list)){
eval(parse(text = paste0("ciat2$Protein_", protein_list[i], " <- 0")))
protein_id <- which(ciat2$Protein == protein_list[i] | ciat2$Protein2 == protein_list[i] | ciat2$Protein3 == protein_list[i] | ciat2$Protein4 == protein_list[i] | ciat2$Protein5 == protein_list[i])
if(length(protein_id) > 0){
eval(parse(text = paste0("ciat2$Protein_", protein_list[i], "[protein_id] <- 1")))
}
}; rm(i, protein_id, protein_list)
ciat2$Protein <- ciat2$Protein2 <- ciat2$Protein3 <- ciat2$Protein4 <- ciat2$Protein5 <- NULL
names(ciat2)
View(ciat2)
saveRDS(ciat2, paste0(root, "/gap_analysis_landraces/Input_data/_occurrence_data/_ciat_data/Bean/ciatOrganizedVariables.RDS"))
install.packages("keras")
library(PCAmixdata)
?PCAmix
data(wine)
str(wine)
X.quanti <- splitmix(wine)$X.quanti
X.quali <- splitmix(wine)$X.quali
View(wine)
pca<-PCAmix(X.quanti[,1:27],X.quali,ndim=4)
pca<-PCAmix(X.quanti[,1:27],X.quali,ndim=4,graph=FALSE)
pca<-PCAmix(X.quanti[,1:27],X.quali,ndim=4,graph=T)
View(X.quali)
wine$Soil
g <- gc()
rm(list = ls())
